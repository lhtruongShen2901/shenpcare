<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Pet Health Passport</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#13eca4", 
              "vet-text": "#03594D",
              "vet-border": "#03594D",
              "vet-button-general": "#D8E268",
              "vet-button-dog": "#FF9124",
              "vet-button-cat": "#FCCDDC",
              "vet-text-secondary": "#6c757d"
            },
            fontFamily: {
              "display": ["Inter", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "full": "9999px"},
          },
        },
      }
    </script>
    <style>
      .material-symbols-outlined {
        font-variation-settings:
        'FILL' 0,
        'wght' 400,
        'GRAD' 0,
        'opsz' 24
      }
    </style>
</head>
<body class="bg-white font-display text-vet-text">

<div class="flex min-h-screen">
  <aside class="w-64 flex-shrink-0 bg-white dark border-r-2 border-vet-border/10">
    <div class="flex h-full min-h-screen flex-col justify-between p-4">
      <div class="flex flex-col gap-4">
        <div class="flex items-center gap-3 p-2">
          <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Doctor's profile picture" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBooOq8NVAukqhBRP4UNGyyQNTPljWW90knQ94DLjr76Q95A0pVUwbH4pSmaBI1CEGtKQFTvDz_lKD1p58eFIHFdS45uFDJaDflq9FpsX78LSwKHSBpgQ-Wel-3GeJGBRnbyNdBzOXV0p7jyvFZ6VCI0aCbqWcZWg10VzXWPzY6VIdzb6yeXHrrn-XewbBQcaQ8QmjrdHcbmiqg9D4dfR9rPZvp5KJPFz_6ghLeSxVExdQb6Hzso6DYLFUMeaNHt4uGyFe3NReYHjd4");'></div>
          <div class="flex flex-col">
            <h1 class="text-vet-text text-base font-bold leading-normal" th:text="${currentUser?.fullName ?: 'BS. Nguyễn Văn An'}">BS. Nguyễn Văn An</h1>
            <p class="text-vet-text/70 text-sm font-normal leading-normal" th:text="${currentUser?.email ?: 'bacsian@phongkham.vn'}">bacsian@phongkham.vn</p>
          </div>
        </div>
        <nav class="flex flex-col gap-2 mt-4">
          <a th:href="@{/doctor/dashboard}" class="flex items-center gap-3 px-3 py-2 text-vet-text/70 hover:text-vet-text hover:bg-vet-text/10 rounded-lg">
            <span class="material-symbols-outlined">dashboard</span>
            <p class="text-sm font-medium leading-normal">Bảng điều khiển</p>
          </a>
          <a th:href="@{/doctor/work}" class="flex items-center gap-3 px-3 py-2 text-vet-text/70 hover:text-vet-text hover:bg-vet-text/10 rounded-lg">
            <span class="material-symbols-outlined">calendar_month</span>
            <p class="text-sm font-medium leading-normal">Quản lý lịch hẹn</p>
          </a>
          <a th:href="@{/doctor/pet-passport}" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-vet-button-general text-vet-text font-bold">
            <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">folder_open</span>
            <p class="text-sm font-medium leading-normal">Hồ sơ bệnh án</p>
          </a>
          <a th:href="@{/doctor/customers}" class="flex items-center gap-3 px-3 py-2 text-vet-text/70 hover:text-vet-text hover:bg-vet-text/10 rounded-lg">
            <span class="material-symbols-outlined">group</span>
            <p class="text-sm font-medium leading-normal">Khách hàng</p>
          </a>
          <a th:href="@{/doctor/reports}" class="flex items-center gap-3 px-3 py-2 text-vet-text/70 hover:text-vet-text hover:bg-vet-text/10 rounded-lg">
            <span class="material-symbols-outlined">bar_chart</span>
            <p class="text-sm font-medium leading-normal">Báo cáo</p>
          </a>
          <a th:href="@{/doctor/settings}" class="flex items-center gap-3 px-3 py-2 text-vet-text/70 hover:text-vet-text hover:bg-vet-text/10 rounded-lg">
            <span class="material-symbols-outlined">settings</span>
            <p class="text-sm font-medium leading-normal">Cài đặt</p>
          </a>
        </nav>
      </div>
      <div class="flex flex-col gap-1">
        <a th:href="@{/logout}" class="flex items-center gap-3 px-3 py-2 text-red-500 hover:text-red-600 hover:bg-red-50 rounded-lg">
          <span class="material-symbols-outlined">logout</span>
          <p class="text-sm font-medium leading-normal">Đăng xuất</p>
        </a>
      </div>
    </div>
  </aside>

  <main class="flex-1 p-6 lg:p-10">
    <div class="max-w-7xl mx-auto">
      <div class="flex flex-wrap justify-between gap-3 mb-8">
        <div class="flex min-w-72 flex-col gap-1">
          <p class="text-vet-text text-4xl font-black leading-tight tracking-[-0.033em]">Hộ Chiếu Sức Khỏe Thú Cưng</p>
          <p class="text-vet-text/70 text-base font-normal leading-normal">Xem và quản lý toàn bộ lịch sử y tế của thú cưng.</p>
        </div>
      </div>

      <div class="bg-white border-2 border-vet-border rounded-xl p-6 mb-8">
        <div class="flex w-full flex-col gap-6 @container md:flex-row md:justify-between md:items-center">
          <div class="flex gap-6 items-center">
            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full w-32 h-32 flex-shrink-0" th:if="${selectedPet != null}" th:style="|background-image: url('@{/doctor/pet-photo/{id}(id=${selectedPet.petId})}');|" th:data-alt="${selectedPet?.name}"></div>
            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full w-32 h-32 flex-shrink-0 bg-gray-100 flex items-center justify-center" th:if="${selectedPet == null}">
              <span class="material-symbols-outlined text-3xl text-vet-text-secondary">pets</span>
            </div>
            <div class="flex flex-col justify-center">
              <p class="text-vet-text text-[22px] font-bold leading-tight tracking-[-0.015em]" th:text="${selectedPet != null ? selectedPet.name + ' (ID: ' + selectedPet.petId + ')' : 'Chọn thú cưng'}">Lucky (ID: PET00123)</p>
              <p class="text-vet-text/80 text-base font-normal leading-normal mt-1" th:text="${selectedPet != null ? (selectedPet.breed + ' - ' + (petAge != null ? petAge + ' tuổi' : '') + ' - ' + (selectedPet.gender != null ? selectedPet.gender : '') + ' - ' + (selectedPet.weightKg != null ? selectedPet.weightKg + 'kg' : '')) : ''}">Golden Retriever - 3 tuổi - Đực - 25kg</p>
              <p class="text-vet-text/80 text-base font-normal leading-normal" th:text="${selectedPet != null && selectedPet.customer != null && selectedPet.customer.user != null ? ('Chủ nuôi: ' + selectedPet.customer.user.fullName + ' - ' + selectedPet.customer.user.phone) : ''}">Chủ nuôi: Anh Trần Bình Minh - 0909123456</p>
            </div>
          </div>
          <div class="flex w-full flex-col @[480px]:flex-row max-w-[480px] gap-3">
            <button onclick="window.print()" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 px-4 bg-white text-vet-text border-2 border-vet-border hover:bg-gray-100 text-sm font-bold leading-normal tracking-[0.015em] flex-1">
              <span class="truncate">In bệnh án</span>
            </button>
            <button th:if="${selectedPet != null}" onclick="addNewPet()" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 px-4 bg-blue-500 hover:bg-blue-600 text-white text-sm font-bold leading-normal tracking-[0.015em] flex-1">
              <span class="truncate">+ Thêm mới</span>
            </button>
            <a th:href="@{/doctor/appointments/new}" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 px-4 bg-vet-button-dog hover:bg-opacity-90 text-vet-text text-sm font-bold leading-normal tracking-[0.015em] flex-1">
              <span class="truncate">Tạo lịch hẹn mới</span>
            </a>
          </div>
        </div>
        <div class="flex gap-3 flex-wrap pt-6 mt-6 border-t-2 border-vet-border" th:if="${selectedPet != null}">
          <div class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-yellow-100 px-3">
            <p class="text-yellow-800 text-sm font-medium leading-normal" th:text="${'Dị ứng: ' + (selectedPet.allergies != null ? selectedPet.allergies : '-')}">Dị ứng: -</p>
          </div>
          <div class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-red-100 px-3">
            <p class="text-red-800 text-sm font-medium leading-normal" th:text="${'Bệnh mãn tính: ' + (selectedPet.chronicConditions != null ? selectedPet.chronicConditions : '-')}">Bệnh mãn tính: -</p>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-1">
          <h2 class="text-vet-text text-xl font-bold leading-tight tracking-[-0.015em] mb-4">Lịch sử khám bệnh</h2>
          <div class="flex flex-col gap-3" th:if="${history != null && !history.isEmpty()}">
            <a th:each="visit,idx : ${history}" th:href="@{/doctor/pet-passport(petId=${selectedPet.petId}, visitId=${visit.bookingId})}" class="p-4 rounded-lg cursor-pointer hover:shadow-md transition" th:classappend="${idx.index == 0 ? 'bg-[#C1DFD9] border-2 border-vet-border' : 'bg-white border border-gray-200 hover:bg-gray-50'}">
              <div class="flex justify-between items-center">
                <p class="text-base font-bold" th:classappend="${idx.index == 0 ? 'text-vet-text' : 'text-gray-700'}" th:text="${#temporals.format(visit.startTime, 'dd/MM/yyyy')}">20/07/2024</p>
                <span th:if="${idx.index == 0}" class="px-2 py-0.5 text-xs font-semibold rounded-full bg-vet-text/10 text-vet-text">Mới nhất</span>
              </div>
              <p class="text-sm mt-1" th:classappend="${idx.index == 0 ? 'text-vet-text/80' : 'text-gray-500'}" th:text="${visit.serviceType ?: 'Khám thú cưng'}">BS. Nguyễn Văn An</p>
              <p class="text-sm mt-2" th:classappend="${idx.index == 0 ? 'text-vet-text' : 'text-gray-700'}" th:text="${visit.notes != null ? (visit.notes.length() > 50 ? (visit.notes.substring(0, 50) + '...') : visit.notes) : 'Không có ghi chú'}">Chẩn đoán: Rối loạn tiêu hoá</p>
            </a>
          </div>
          <div th:if="${history == null || history.isEmpty()}" class="p-4 rounded-lg bg-white border border-gray-200 text-center">
            <p class="text-gray-500 text-sm">Chưa có lịch sử khám bệnh</p>
          </div>
        </div>

        <div class="lg:col-span-2">
          <h2 class="text-vet-text text-xl font-bold leading-tight tracking-[-0.015em] mb-4" th:text="${selectedVisit != null ? 'Chi tiết lần khám: ' + #temporals.format(selectedVisit.startTime, 'dd/MM/yyyy') : 'Chi tiết lần khám'}">Chi tiết lần khám: 20/07/2024</h2>
          <div class="bg-white border-2 border-vet-border rounded-xl p-6">
            <div class="border-b-2 border-vet-border mb-6">
              <div class="flex space-x-6">
                <button type="button" class="pb-3 border-b-4 border-vet-border text-vet-text text-sm font-semibold">Chẩn đoán &amp; Điều trị</button>
                <button type="button" class="pb-3 border-b-4 border-transparent text-vet-text/60 hover:text-vet-text hover:border-vet-border/50 text-sm font-semibold">Đơn thuốc</button>
                <button type="button" class="pb-3 border-b-4 border-transparent text-vet-text/60 hover:text-vet-text hover:border-vet-border/50 text-sm font-semibold">Dịch vụ</button>
                <button type="button" class="pb-3 border-b-4 border-transparent text-vet-text/60 hover:text-vet-text hover:border-vet-border/50 text-sm font-semibold">Ghi chú</button>
              </div>
            </div>
            <form th:action="@{/doctor/pet-passport/save}" method="post" class="space-y-6">
              <input type="hidden" name="petId" th:value="${selectedPet != null ? selectedPet.petId : ''}" />
              <div>
                <label class="block text-sm font-medium text-vet-text mb-2" for="symptoms">Triệu chứng &amp; Chẩn đoán</label>
                <textarea class="w-full bg-white border-2 border-vet-border/50 text-vet-text rounded-lg p-3 text-sm focus:ring-vet-border focus:border-vet-border placeholder:text-gray-400" id="symptoms" name="symptoms" rows="4" th:placeholder="'Nhập triệu chứng...'"th:text="${selectedVisit != null && selectedVisit.notes != null ? selectedVisit.notes : ''}"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-vet-text mb-2" for="treatment">Hướng dẫn chăm sóc tại nhà</label>
                <textarea class="w-full bg-white border-2 border-vet-border/50 text-vet-text rounded-lg p-3 text-sm focus:ring-vet-border focus:border-vet-border placeholder:text-gray-400" id="treatment" name="treatment" rows="3" th:placeholder="'Nhập hướng dẫn...'"></textarea>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-vet-text mb-2" for="petAllergies">Dị ứng</label>
                  <input class="w-full bg-white border-2 border-vet-border/50 text-vet-text rounded-lg p-2.5 text-sm focus:ring-vet-border focus:border-vet-border placeholder:text-gray-400" id="petAllergies" name="petAllergies" type="text" placeholder="Ví dụ: Phấn hoa, sữa..." th:value="${selectedPet != null && selectedPet.allergies != null ? selectedPet.allergies : ''}"/>
                </div>
                <div>
                  <label class="block text-sm font-medium text-vet-text mb-2" for="petChronicConditions">Bệnh mãn tính</label>
                  <input class="w-full bg-white border-2 border-vet-border/50 text-vet-text rounded-lg p-2.5 text-sm focus:ring-vet-border focus:border-vet-border placeholder:text-gray-400" id="petChronicConditions" name="petChronicConditions" type="text" placeholder="Ví dụ: Viêm da cơ địa..." th:value="${selectedPet != null && selectedPet.chronicConditions != null ? selectedPet.chronicConditions : ''}"/>
                </div>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-vet-text mb-2" for="recheck-date">Lịch tái khám</label>
                  <input class="w-full bg-white border-2 border-vet-border/50 text-vet-text rounded-lg p-2.5 text-sm focus:ring-vet-border focus:border-vet-border" id="recheck-date" name="recheckDate" type="date" th:value="${selectedVisit != null && selectedVisit.startTime != null ? #temporals.format(selectedVisit.startTime, 'yyyy-MM-dd') : ''}"/>
                </div>
                <div>
                  <label class="block text-sm font-medium text-vet-text mb-2" for="status">Trạng thái</label>
                  <select class="w-full bg-white border-2 border-vet-border/50 text-vet-text rounded-lg p-2.5 text-sm focus:ring-vet-border focus:border-vet-border" id="status" name="status">
                    <option value="PENDING" th:selected="${selectedVisit != null && selectedVisit.status == 'PENDING'}">Đang điều trị</option>
                    <option value="STABLE" th:selected="${selectedVisit != null && selectedVisit.status == 'STABLE'}">Ổn định</option>
                    <option value="COMPLETED" th:selected="${selectedVisit != null && selectedVisit.status == 'COMPLETED'}">Đã hoàn thành</option>
                  </select>
                </div>
              </div>
              <div class="flex justify-end pt-4">
                <button class="flex cursor-pointer items-center justify-center rounded-lg h-11 px-6 bg-vet-button-general hover:bg-opacity-90 text-vet-text text-sm font-bold leading-normal tracking-[0.015em]" type="submit">
                  <span class="truncate">Lưu Bệnh Án</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Pet selector -->
      <div class="mt-6">
        <label class="block text-sm font-medium text-vet-text mb-2">Chọn thú cưng</label>
        <div class="flex gap-2 mb-4">
          <select id="petSelect" class="flex-1 border-2 border-vet-border rounded-lg p-3 text-vet-text focus:outline-none focus:ring-2 focus:ring-vet-border" onchange="location.href=this.value">
            <option value="">-- Chọn thú cưng --</option>
            <option th:each="p : ${pets}" th:value="@{/doctor/pet-passport(petId=${p.petId})}" th:selected="${selectedPet != null && selectedPet.petId == p.petId}" th:text="${p.name + ' (' + p.species + ')'}">Micky (Chó)</option>
          </select>
        </div>
        <div class="mt-3" th:if="${selectedPet != null}">
          <form th:action="@{/doctor/pet-photo/{id}(id=${selectedPet.petId})}" method="post" enctype="multipart/form-data">
            <label class="block text-sm font-medium text-vet-text mb-2">Ảnh thú cưng</label>
            <div class="flex items-center gap-3">
              <input name="file" type="file" accept="image/*" class="block w-full text-sm text-vet-text" />
              <button type="submit" class="ml-2 inline-flex items-center px-4 py-2 bg-vet-button-general text-vet-text font-bold rounded-lg">Tải lên</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Quick Update Pet Health Info -->
      <div class="mt-6" th:if="${selectedPet != null}">
        <div class="bg-white border-2 border-vet-border rounded-xl p-6">
          <h3 class="text-vet-text text-lg font-bold mb-4">Thông tin sức khỏe thú cưng</h3>
          <form th:action="@{/doctor/pet-passport/save}" method="post" class="space-y-4">
            <input type="hidden" name="petId" th:value="${selectedPet.petId}"/>
            <input type="hidden" name="petName" th:value="${selectedPet.name}"/>
            <input type="hidden" name="petSpecies" th:value="${selectedPet.species}"/>
            <input type="hidden" name="petBreed" th:value="${selectedPet.breed}"/>
            <input type="hidden" name="petGender" th:value="${selectedPet.gender}"/>
            <input type="hidden" name="petBirthDate" th:if="${selectedPet.birthDate != null}" th:value="${#temporals.format(selectedPet.birthDate, 'yyyy-MM-dd')}"/>
            <input type="hidden" name="petWeight" th:if="${selectedPet.weightKg != null}" th:value="${selectedPet.weightKg}"/>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-vet-text mb-2" for="quick-allergies">Dị ứng</label>
                <input class="w-full bg-white border-2 border-vet-border/50 text-vet-text rounded-lg p-2.5 text-sm focus:ring-vet-border focus:border-vet-border placeholder:text-gray-400" 
                       id="quick-allergies" name="petAllergies" type="text" 
                       placeholder="Ví dụ: Phấn hoa, sữa..." 
                       th:value="${selectedPet.allergies != null ? selectedPet.allergies : ''}"/>
              </div>
              <div>
                <label class="block text-sm font-medium text-vet-text mb-2" for="quick-chronic">Bệnh mãn tính</label>
                <input class="w-full bg-white border-2 border-vet-border/50 text-vet-text rounded-lg p-2.5 text-sm focus:ring-vet-border focus:border-vet-border placeholder:text-gray-400" 
                       id="quick-chronic" name="petChronicConditions" type="text" 
                       placeholder="Ví dụ: Viêm da cơ địa..." 
                       th:value="${selectedPet.chronicConditions != null ? selectedPet.chronicConditions : ''}"/>
              </div>
            </div>
            <div class="flex justify-end pt-2">
              <button class="flex cursor-pointer items-center justify-center rounded-lg h-10 px-6 bg-vet-button-dog hover:bg-opacity-90 text-vet-text text-sm font-bold leading-normal tracking-[0.015em]" type="submit">
                <span class="truncate">Cập nhật thông tin sức khỏe</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>
</div>

</body>
</html>
