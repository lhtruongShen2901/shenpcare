<!DOCTYPE html>
<html class="light" lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/layout :: adminHead">
    <title>ShenPCare - Quản lý Khách hàng</title>
</head>
<body class="font-display bg-background-light">

<div th:replace="admin/layout :: adminShell(~{::section}, ${activeMenu})">
    <section>
        <header class="flex flex-wrap justify-between items-center gap-4 mb-6">
            <h1 class="text-[#03594D] text-4xl font-black leading-tight tracking-tight">
                Quản lý Khách hàng
            </h1>
            </header>

        <div th:if="${message}" class="mb-4 rounded-xl bg-emerald-50 text-emerald-800 px-4 py-3 text-sm">
            <span class="font-semibold">Thông báo:</span>
            <span th:text="${message}"></span>
        </div>

        <form class="flex flex-col md:flex-row gap-4 mb-4" method="get" th:action="@{/admin/customers}">
            <div class="flex-grow">
                <label class="flex flex-col min-w-40 h-12 w-full">
                    <div class="flex w-full flex-1 items-stretch rounded-full h-full">
                        <div class="text-gray-500 flex bg-[#F0F2F5] items-center justify-center pl-4 rounded-l-full border-r-0">
                            <span class="material-symbols-outlined">search</span>
                        </div>
                        <input class="form-input flex w-full min-w-0 flex-1 rounded-full text-[#03594D] 
                                      bg-[#F0F2F5] h-full px-4 border-none focus:ring-0"
                               type="text" name="keyword" placeholder="Tìm theo tên, email, sđt..."
                               th:value="${keyword} ?: ''"/>
                    </div>
                </label>
            </div>
            <div class="flex gap-3 items-center">
                <select name="status" class="flex h-12 rounded-full bg-[#F0F2F5] px-4 text-[#03594D] text-sm font-medium border-none">
                    <option value="ALL" th:selected="${selectedStatus} == 'ALL'">Tất cả trạng thái</option>
                    <option value="ACTIVE" th:selected="${selectedStatus} == 'ACTIVE'">Hoạt động</option>
                    <option value="LOCKED" th:selected="${selectedStatus} == 'LOCKED'">Bị khóa</option>
                </select>
                <button type="submit" class="flex h-12 items-center justify-center gap-x-2 rounded-full bg-[#03594D] px-5 text-white text-sm font-semibold">
                    <span class="material-symbols-outlined text-[18px]">tune</span>
                    <span>Lọc</span>
                </button>
            </div>
        </form>

        <div class="bg-white rounded-lg shadow-sm overflow-x-auto">
            <table class="w-full text-sm text-left text-[#03594D]">
                <thead class="text-xs uppercase bg-[#F0F2F5]">
                <tr>
                    <th class="px-6 py-3">Khách hàng</th>
                    <th class="px-6 py-3">Email / SĐT</th>
                    <th class="px-6 py-3">Trạng thái</th>
                    <th class="px-6 py-3">Ngày tham gia</th>
                    <th class="px-6 py-3 text-center">Hành động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(users)}">
                    <td colspan="5" class="px-6 py-6 text-center text-gray-500">Không tìm thấy khách hàng nào.</td>
                </tr>
                <tr th:each="user : ${users}" class="bg-white border-b hover:bg-[#F0F2F5]/60">
                    <th scope="row" class="flex items-center px-6 py-4 whitespace-nowrap">
                        <div class="w-10 h-10 rounded-full bg-[#D8E268] flex items-center justify-center text-[#03594D] font-bold">
                            <span th:text="${(user.fullName != null && user.fullName != '') ? #strings.substring(user.fullName,0,1) : 'C'}">C</span>
                        </div>
                        <div class="pl-3">
                            <div class="text-base font-semibold" th:text="${user.fullName}"></div>
                            <div class="font-normal text-gray-500" th:text="${user.username}"></div>
                        </div>
                    </th>
                    <td class="px-6 py-4">
                        <div th:text="${user.email}"></div>
                        <div class="text-xs text-gray-500" th:text="${user.phone}"></div>
                    </td>
                    <td class="px-6 py-4">
                        <span th:if="${user.active}" class="px-3 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full">Hoạt động</span>
                        <span th:if="${!user.active}" class="px-3 py-1 text-xs font-medium text-red-800 bg-red-100 rounded-full">Bị khóa</span>
                    </td>
                    <td class="px-6 py-4" th:text="${#temporals.format(user.createdAt, 'dd-MM-yyyy')}"></td>
                    <td class="px-6 py-4 text-center">
                        <form th:action="@{'/admin/customers/' + ${user.userId} + '/toggle-status'}" method="post" class="inline-flex">
                            <button type="submit" class="p-2 hover:bg-gray-100 rounded-full" title="Khóa/Mở khóa">
                                <span class="material-symbols-outlined" th:text="${user.active} ? 'lock_open' : 'lock'"></span>
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>
</div>
</body>
</html>