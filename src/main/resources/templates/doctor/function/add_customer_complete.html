<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Quản lý Thú Y - Thêm khách hàng và thú cưng</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#03594D",
                        accent: "#D8E268",
                        dog: "#FF9124",
                        cat: "#FCCDDC",
                        "background-light": "#F8FAFC",
                        "background-dark": "#0F172A",
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#1E293B",
                    },
                    fontFamily: {
                        sans: ["Nunito", "sans-serif"],
                        display: ["Nunito", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "1rem",
                    },
                },
            },
        };
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .nav-item {
                @apply flex items-center px-4 py-3 mb-2 rounded-xl transition-colors duration-200 font-bold text-sm;
            }
            .nav-item-active {
                @apply bg-accent text-primary shadow-sm;
            }
            .nav-item-inactive {
                @apply text-primary dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700;
            }
            .form-input {
                @apply w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm focus:ring-2 focus:ring-accent focus:border-accent shadow-sm transition-shadow dark:text-white dark:placeholder-gray-500 text-primary placeholder-gray-400 font-medium;
            }
            .form-label {
                @apply block mb-2 text-sm font-bold text-primary dark:text-gray-300;
            }
            .section-header {
                @apply flex items-center gap-2 mb-6 pb-2 border-b border-gray-100 dark:border-slate-700 text-primary dark:text-accent;
            }
            .section-title {
                @apply text-lg font-extrabold text-primary dark:text-white;
            }
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-gray-800 dark:text-gray-100 font-sans transition-colors duration-300 overflow-hidden h-screen flex">
    <!-- SIDEBAR -->
    <aside class="w-72 bg-surface-light dark:bg-surface-dark h-full flex flex-col border-r border-gray-100 dark:border-slate-700 shadow-sm relative z-20 hidden md:flex">
        <div class="p-6 flex items-center space-x-4 mb-4">
            <div class="relative">
                <img alt="Avatar Bác sĩ" class="w-12 h-12 rounded-full object-cover ring-2 ring-accent" 
                     th:src="'https://lh3.googleusercontent.com/aida-public/AB6AXuBXrbgxSAdX_gtvpl1W5q4Ekf9qRsXvEJjNBRwsjxC-PQ0DVHr0ATmDbg9QWRGQiRnsiyIh2N5_08CpDN2AiVgNsa5ZbEiunSsxiGOP0Xv46BPdC7csTARiMQvTmArI3zBi-cE9XdsCozEFPrGNDX3BRwGNnZ89rAvHrR28kgKVBKIbMeXSSQrbR6tvwRNMhjEDr5j_xIEtujMhggtgROZTc96-8EL4T8S8sLlpfqBRmmlAXwEw5dN5lOIYUINuJAiQKGH98K1BV7jU'"/>
                <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-surface-dark"></div>
            </div>
            <div>
                <h3 class="text-primary dark:text-accent font-extrabold text-lg" th:text="${currentUser?.fullName ?: 'BS. Nguyễn Văn A'}">Dr. Tét</h3>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-semibold">Bác sĩ thú y</p>
            </div>
        </div>
        <nav class="flex-1 px-4 overflow-y-auto">
            <a class="nav-item nav-item-inactive" th:href="@{/doctor/dashboard}">
                <span class="material-icons-round mr-3">dashboard</span>
                Bảng điều khiển
            </a>
            <a class="nav-item nav-item-inactive" th:href="@{/doctor/work}">
                <span class="material-icons-round mr-3">calendar_month</span>
                Quản lý lịch hẹn
            </a>
            <a class="nav-item nav-item-inactive" th:href="@{/doctor/pet-passport}">
                <span class="material-icons-round mr-3">folder_open</span>
                Hồ sơ bệnh án
            </a>
            <a class="nav-item nav-item-active" th:href="@{/doctor/customers}">
                <span class="material-icons-round mr-3">people_alt</span>
                Khách hàng
            </a>
            <a class="nav-item nav-item-inactive" th:href="@{/doctor/reports}">
                <span class="material-icons-round mr-3">bar_chart</span>
                Báo cáo
            </a>
            <a class="nav-item nav-item-inactive" th:href="@{/doctor/settings}">
                <span class="material-icons-round mr-3">settings</span>
                Cài đặt
            </a>
        </nav>
        <div class="p-4 mt-auto">
            <a class="flex items-center px-4 py-3 text-red-500 dark:text-red-400 font-bold text-sm hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors" th:href="@{/logout}">
                <span class="material-icons-round mr-3 transform rotate-180">logout</span>
                Đăng xuất
            </a>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 h-full overflow-y-auto flex flex-col p-4 lg:p-10 relative bg-background-light dark:bg-background-dark">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-extrabold text-primary dark:text-white tracking-tight">Thêm khách hàng và thú cưng</h1>
                <p class="text-gray-500 dark:text-gray-400 mt-1 text-sm">Điền thông tin chi tiết của khách hàng và danh sách thú cưng mới</p>
            </div>
        </header>

        <!-- Messages -->
        <div th:if="${success}" class="mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg text-green-800 dark:text-green-300" th:text="${success}">
            Success
        </div>
        <div th:if="${error}" class="mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-800 dark:text-red-300" th:text="${error}">
            Error
        </div>

        <!-- Form Card -->
        <div class="bg-surface-light dark:bg-surface-dark rounded-3xl shadow-sm border border-gray-100 dark:border-slate-700 flex-1 overflow-hidden flex flex-col">
            <div class="flex-1 overflow-y-auto p-6 md:p-8 lg:p-10">
                <form th:action="@{/doctor/customers}" method="post" id="customerForm" class="grid grid-cols-1 xl:grid-cols-2 gap-10">
                    <!-- Customer Info Section -->
                    <div class="space-y-6">
                        <div class="section-header">
                            <span class="material-symbols-outlined text-2xl">person_pin</span>
                            <h2 class="section-title">Thông tin khách hàng</h2>
                        </div>

                        <div>
                            <label class="form-label" for="customer-name">
                                Tên khách hàng <span class="text-red-500">*</span>
                            </label>
                            <input class="form-input" id="customer-name" name="fullName" placeholder="Ví dụ: Nguyễn Văn A" required="" type="text"/>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <label class="form-label" for="phone-number">
                                    Số điện thoại <span class="text-red-500">*</span>
                                </label>
                                <input class="form-input" id="phone-number" name="phone" placeholder="090xxxxxxx" required="" type="tel"/>
                            </div>
                            <div>
                                <label class="form-label" for="email">
                                    Email <span class="font-normal text-gray-400 text-xs ml-1">(Tùy chọn)</span>
                                </label>
                                <input class="form-input" id="email" name="email" placeholder="example@email.com" type="email"/>
                            </div>
                        </div>

                        <div>
                            <label class="form-label" for="address">
                                Địa chỉ <span class="text-red-500">*</span>
                            </label>
                            <textarea class="form-input min-h-[120px] resize-none" id="address" name="address" placeholder="Ví dụ: 123 Đường ABC, Phường X..." required=""></textarea>
                        </div>
                    </div>

                    <!-- Pet Info Section -->
                    <div class="space-y-6 relative xl:pl-10 xl:border-l border-gray-100 dark:border-slate-700">
                        <div class="section-header justify-between">
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-2xl">pets</span>
                                <h2 class="section-title">Thông tin thú cưng</h2>
                            </div>
                            <span class="text-xs font-semibold text-primary/70 bg-primary/5 px-3 py-1 rounded-full">Có thể thêm nhiều</span>
                        </div>

                        <div class="space-y-6" id="pet-list-container">
                            <!-- Pet template will be inserted here -->
                        </div>

                        <button class="w-full py-4 border-2 border-dashed border-primary/30 hover:border-primary hover:bg-primary/5 dark:hover:bg-primary/20 rounded-2xl flex flex-col items-center justify-center gap-2 text-primary dark:text-accent font-bold transition-all group active:scale-[0.99]" type="button" onclick="addPet()">
                            <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-colors">
                                <span class="material-icons-round text-2xl">add</span>
                            </div>
                            <span>Thêm thú cưng khác</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="px-6 py-5 border-t border-gray-100 dark:border-slate-700 flex justify-end items-center gap-4 bg-gray-50 dark:bg-slate-800/50">
                <a th:href="@{/doctor/customers}" class="px-6 py-2.5 rounded-xl border-2 border-accent text-primary dark:text-accent font-bold hover:bg-accent/10 transition-all active:scale-95">
                    Hủy
                </a>
                <button type="submit" form="customerForm" class="px-8 py-2.5 rounded-xl bg-accent text-primary font-bold shadow-lg shadow-accent/20 hover:brightness-95 flex items-center gap-2 transition-all active:scale-95">
                    <span class="material-icons-round text-xl">save</span>
                    Lưu
                </button>
            </div>
        </div>
    </main>

    <!-- Decorative Icon -->
    <div class="fixed bottom-10 right-10 pointer-events-none opacity-5 dark:opacity-0 z-0">
        <span class="material-icons-round text-9xl text-primary transform rotate-12">pets</span>
    </div>

    <script>
        let petCount = 0;

        function createPetHTML(index) {
            return `
                <div class="pet-card p-5 border-2 border-gray-100 dark:border-slate-600 rounded-2xl bg-gray-50/50 dark:bg-slate-800/30 relative group transition-colors hover:border-primary/20" data-pet-index="${index}">
                    <div class="absolute -top-3 left-4 px-3 py-0.5 bg-surface-light dark:bg-surface-dark text-xs font-bold text-primary dark:text-accent uppercase tracking-wider border border-gray-200 dark:border-slate-600 rounded-lg shadow-sm z-10">
                        Thú cưng #${index + 1}
                    </div>
                    <button class="absolute -top-3 right-4 p-1 bg-surface-light dark:bg-surface-dark text-gray-400 hover:text-red-500 border border-gray-200 dark:border-slate-600 rounded-full shadow-sm transition-colors z-10" title="Xóa thú cưng này" type="button" onclick="removePet(${index})">
                        <span class="material-icons-round text-sm block">close</span>
                    </button>

                    <div class="flex flex-col sm:flex-row gap-6 mt-2">
                        <!-- Photo Upload -->
                        <div class="w-full sm:w-32 flex-shrink-0">
                            <label class="group/img block w-full aspect-square sm:h-32 border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-2xl hover:border-accent hover:bg-white dark:hover:bg-slate-800 transition-all cursor-pointer flex flex-col items-center justify-center text-center p-2 bg-white dark:bg-slate-800 relative overflow-hidden">
                                <img alt="Pet photo" class="pet-photo absolute inset-0 w-full h-full object-cover hidden" />
                                <span class="material-symbols-outlined text-3xl text-gray-300 group-hover/img:text-accent mb-1 transition-colors pet-icon">add_a_photo</span>
                                <span class="text-[10px] font-bold text-primary dark:text-gray-300 z-10 uppercase">Ảnh</span>
                                <input accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer pet-image-input" type="file" onchange="handleImageUpload(this, ${index})"/>
                            </label>
                        </div>

                        <!-- Pet Details -->
                        <div class="flex-1 space-y-4">
                            <div>
                                <label class="form-label text-xs uppercase tracking-wide opacity-80" for="pet-name-${index}">Tên thú cưng <span class="text-red-500">*</span></label>
                                <input class="form-input pet-name" id="pet-name-${index}" placeholder="Ví dụ: Milu" required="" type="text" name="pets[${index}].name"/>
                            </div>

                            <!-- Species Selection -->
                            <div>
                                <label class="form-label text-xs uppercase tracking-wide opacity-80 mb-2">Loài <span class="text-red-500">*</span></label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="cursor-pointer relative">
                                        <input class="peer sr-only pet-species" name="pets[${index}].species" type="radio" value="Chó" required=""/>
                                        <div class="flex items-center justify-center gap-2 p-2.5 rounded-xl border border-gray-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-500 dark:text-gray-400 transition-all hover:border-dog peer-checked:bg-dog peer-checked:text-white peer-checked:border-dog shadow-sm">
                                            <span class="material-symbols-outlined text-lg">sound_detection_dog_barking</span>
                                            <span class="font-bold text-sm">Chó</span>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer relative">
                                        <input class="peer sr-only pet-species" name="pets[${index}].species" type="radio" value="Mèo" required=""/>
                                        <div class="flex items-center justify-center gap-2 p-2.5 rounded-xl border border-gray-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-gray-500 dark:text-gray-400 transition-all hover:border-cat peer-checked:bg-cat peer-checked:text-primary peer-checked:border-cat shadow-sm">
                                            <span class="material-symbols-outlined text-lg">pest_control_rodent</span>
                                            <span class="font-bold text-sm">Mèo</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Breed and DOB -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="form-label text-xs uppercase tracking-wide opacity-80" for="breed-${index}">Giống <span class="text-red-500">*</span></label>
                            <input class="form-input pet-breed" id="breed-${index}" placeholder="Ví dụ: Poodle" required="" type="text" name="pets[${index}].breed"/>
                        </div>
                        <div>
                            <label class="form-label text-xs uppercase tracking-wide opacity-80" for="dob-${index}">Ngày sinh</label>
                            <input class="form-input pet-dob" id="dob-${index}" type="date" name="pets[${index}].birthDate"/>
                        </div>
                    </div>
                </div>
            `;
        }

        function addPet() {
            const container = document.getElementById('pet-list-container');
            const petHTML = createPetHTML(petCount);
            container.insertAdjacentHTML('beforeend', petHTML);
            petCount++;
        }

        function removePet(index) {
            const card = document.querySelector(`[data-pet-index="${index}"]`);
            if (card) {
                card.remove();
            }
        }

        function handleImageUpload(input, index) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const card = document.querySelector(`[data-pet-index="${index}"]`);
                    if (card) {
                        const photo = card.querySelector('.pet-photo');
                        const icon = card.querySelector('.pet-icon');
                        photo.src = e.target.result;
                        photo.classList.remove('hidden');
                        icon.classList.add('hidden');
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Initialize with one pet
        window.addEventListener('DOMContentLoaded', function() {
            addPet();
        });
    </script>
</body>
</html>
