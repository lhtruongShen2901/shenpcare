<!DOCTYPE html>
<html class="light" lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/layout :: adminHead">
    <title>Quản lý Đơn thuốc Online</title>
</head>
<body class="font-display bg-background-light">

<div th:replace="admin/layout :: adminShell(~{::section}, 'orders')">
    <section>
        <h1 class="text-[#03594D] text-3xl font-black mb-6">Quản lý Đơn Thuốc Online</h1>

        <div th:if="${message}" class="bg-green-100 text-green-700 p-3 rounded mb-4" th:text="${message}"></div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <table class="w-full text-sm text-left">
                <thead class="bg-gray-50 text-gray-500 font-bold uppercase">
                    <tr>
                        <th class="px-6 py-4">Mã Đơn</th>
                        <th class="px-6 py-4">Khách hàng</th>
                        <th class="px-6 py-4">Sản phẩm</th>
                        <th class="px-6 py-4">Tổng tiền</th>
                        <th class="px-6 py-4">Trạng thái</th>
                        <th class="px-6 py-4">Hành động</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    <tr th:each="o : ${orders}" class="hover:bg-gray-50">
                        <td class="px-6 py-4 font-bold text-[#03594D]" th:text="'#' + ${o.orderId}"></td>
                        <td class="px-6 py-4">
                            <div class="font-bold">Khách ID: <span th:text="${o.customerId}"></span></div>
                            <div class="text-xs text-gray-500" th:text="${o.shippingAddress}"></div>
                            <div class="text-xs text-gray-400" th:text="${#temporals.format(o.orderDate, 'dd-MM HH:mm')}"></div>
                        </td>
                        <td class="px-6 py-4">
                            <div th:each="item : ${o.orderItems}" class="mb-1">
                                • <span th:text="${item.product.name}"></span> 
                                <span class="font-bold text-xs bg-gray-100 px-1 rounded">x<span th:text="${item.quantity}"></span></span>
                            </div>
                        </td>
                        <td class="px-6 py-4 font-bold text-emerald-600" th:text="${#numbers.formatDecimal(o.totalAmount, 0, 'COMMA', 0, 'POINT')} + 'đ'"></td>
                        <td class="px-6 py-4">
                            <span th:if="${o.status == 'PENDING'}" class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-bold">Chờ xử lý</span>
                            <span th:if="${o.status == 'CONFIRMED'}" class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold">Đang giao</span>
                            <span th:if="${o.status == 'COMPLETED'}" class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-bold">Hoàn thành</span>
                            <span th:if="${o.status == 'CANCELLED'}" class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-bold">Đã hủy</span>
                        </td>
                        <td class="px-6 py-4">
                            <div th:if="${o.status == 'PENDING'}" class="flex gap-2">
                                <form action="/admin/orders/update-status" method="post">
                                    <input type="hidden" name="orderId" th:value="${o.orderId}">
                                    <input type="hidden" name="status" value="CONFIRMED">
                                    <button type="submit" class="p-2 bg-green-100 text-green-600 rounded hover:bg-green-200" title="Xác nhận & Giao hàng">
                                        <span class="material-symbols-outlined text-lg">local_shipping</span>
                                    </button>
                                </form>
                                <form action="/admin/orders/update-status" method="post" onsubmit="return confirm('Hủy đơn hàng này?');">
                                    <input type="hidden" name="orderId" th:value="${o.orderId}">
                                    <input type="hidden" name="status" value="CANCELLED">
                                    <button type="submit" class="p-2 bg-red-100 text-red-600 rounded hover:bg-red-200" title="Hủy đơn">
                                        <span class="material-symbols-outlined text-lg">cancel</span>
                                    </button>
                                </form>
                            </div>
                            
                            <div th:if="${o.status == 'CONFIRMED'}" class="flex gap-2">
                                <form action="/admin/orders/update-status" method="post">
                                    <input type="hidden" name="orderId" th:value="${o.orderId}">
                                    <input type="hidden" name="status" value="COMPLETED">
                                    <button type="submit" class="p-2 bg-blue-100 text-blue-600 rounded hover:bg-blue-200" title="Đánh dấu Hoàn thành">
                                        <span class="material-symbols-outlined text-lg">check_circle</span>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
</div>
</body>
</html>