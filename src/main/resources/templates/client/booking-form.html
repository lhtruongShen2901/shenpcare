<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Đặt Lịch Dịch Vụ - ShenPCare</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/client-booking.css}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>
<body>

<div class="booking-card">
    <div class="card-header-custom">
        <h3>ĐẶT LỊCH DỊCH VỤ</h3>
        <p>Chăm sóc tận tâm - Dịch vụ xứng tầm</p>
    </div>

    <div class="card-body-custom">
        <div th:if="${message}" class="alert alert-success d-flex align-items-center rounded-3 border-0 bg-success-subtle text-success fw-bold">
            <span class="material-icons-round me-2">check_circle</span>
            <span th:text="${message}"></span>
        </div>
        <div th:if="${error}" class="alert alert-danger d-flex align-items-center rounded-3 border-0 bg-danger-subtle text-danger fw-bold">
            <span class="material-icons-round me-2">error</span>
            <span th:text="${error}"></span>
        </div>

        <form th:action="@{/booking/submit}" th:object="${booking}" method="post">
            
            <input type="hidden" th:field="*{customerId}">

            <div class="row g-3">
                <div class="col-12">
                    <label class="form-label">Dịch vụ mong muốn <span class="text-danger">*</span></label>
                    <select class="form-select" th:field="*{serviceId}" required>
                        <option value="">-- Vui lòng chọn dịch vụ --</option>
                        <option th:each="s : ${services}" 
                                th:value="${s.serviceId}" 
                                th:text="${s.name + ' (' + s.durationMinutes + ' phút) - Giá từ: ' + #numbers.formatDecimal(s.fixedPrice, 0, 'COMMA', 0, 'POINT') + 'đ'}">
                        </option>
                    </select>
                </div>

                <div class="col-12">
                    <label class="form-label">Bé cưng nào sẽ sử dụng dịch vụ? <span class="text-danger">*</span></label>
                    
                    <div th:if="${not #lists.isEmpty(myPets)}">
                        <select class="form-select" th:field="*{petId}" required>
                            <option value="">-- Chọn bé cưng --</option>
                            <option th:each="p : ${myPets}" 
                                    th:value="${p.petId}" 
                                    th:text="${p.name + ' (' + p.species + ' - ' + p.breed + ')'}">
                            </option>
                        </select>
                    </div>

                    <div th:if="${#lists.isEmpty(myPets)}" class="alert alert-warning border-0 rounded-3">
                        <i class="material-icons-round align-middle">pets</i>
                        <strong>Bạn chưa có hồ sơ thú cưng nào!</strong>
                        <br>Vui lòng tạo hồ sơ cho bé trước khi đặt lịch.
                    </div>

                    <a href="#" class="add-pet-link">
                        <span class="material-icons-round" style="font-size: 18px;">add_circle</span>
                        Thêm hồ sơ thú cưng mới
                    </a>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Ngày dự kiến <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" th:field="*{bookingDate}" required id="dateInput">
                </div>

                <div class="col-12">
                    <label class="form-label">Ghi chú cho Bác sĩ/Groomer</label>
                    <textarea class="form-control" rows="3" th:field="*{notes}" placeholder="Ví dụ: Bé sợ nước, dị ứng gà, cần cắt móng kỹ..."></textarea>
                </div>

                <div class="col-12">
                    <div class="urgent-box">
                        <input class="form-check-input mt-0" type="checkbox" id="urgentCheck">
                        <label class="form-check-label fw-bold text-danger" for="urgentCheck" style="cursor: pointer;">
                            Yêu cầu dịch vụ Khẩn Cấp (Ưu tiên xếp lịch ngay)
                        </label>
                    </div>
                    </div>

                <div class="col-12 mt-4">
                    <button type="submit" class="btn btn-brand" th:disabled="${#lists.isEmpty(myPets)}">
                        GỬI YÊU CẦU ĐẶT LỊCH
                    </button>
                    <div class="text-center mt-3">
                        <a href="/" class="text-decoration-none" style="color: var(--brand-text); font-size: 0.9rem;">
                            <i class="material-icons-round align-middle" style="font-size: 16px;">arrow_back</i> Quay về trang chủ
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    // Script nhỏ để set ngày tối thiểu là hôm nay
    document.addEventListener('DOMContentLoaded', function() {
        const dateInput = document.getElementById('dateInput');
        if(dateInput) {
            const today = new Date().toISOString().split('T')[0];
            dateInput.setAttribute('min', today);
        }
    });
</script>

</body>
</html>