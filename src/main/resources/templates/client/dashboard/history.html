<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>L·ªãch S·ª≠ Giao D·ªãch</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            .nav-pills .nav-link.active { background-color: #03594D; }
            .nav-pills .nav-link { color: #03594D; font-weight: bold; margin-right: 10px; }
            .btn-momo { background-color: #A50064; color: white; border: none; font-size: 0.8rem; font-weight: bold; }
            .btn-momo:hover { background-color: #c40076; color: white; }
        </style>
    </head>
    <body class="bg-light py-5">
        <div class="container bg-white p-5 rounded-4 shadow-sm" style="max-width: 1100px;">

            <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
                <div class="btn-group">
                    <a href="/my-account/profile" class="btn btn-outline-secondary"><i class="fa-solid fa-user me-2"></i>H·ªì s∆°</a>
                    <a href="/my-account/pets" class="btn btn-outline-secondary"><i class="fa-solid fa-paw me-2"></i>Th√∫ c∆∞ng</a>
                    <a href="/my-account/history" class="btn btn-primary active"><i class="fa-solid fa-clock-rotate-left me-2"></i>L·ªãch s·ª≠</a>
                </div>
                <a href="/" class="text-decoration-none text-muted"><i class="fa-solid fa-arrow-left me-1"></i>Trang ch·ªß</a>
            </div>

            <div th:if="${message}" class="alert alert-success d-flex align-items-center mb-4">
                <i class="fa-solid fa-check-circle me-2"></i> <span th:text="${message}"></span>
            </div>
            <div th:if="${error}" class="alert alert-danger d-flex align-items-center mb-4">
                <i class="fa-solid fa-exclamation-circle me-2"></i> <span th:text="${error}"></span>
            </div>

            <h4 class="mb-4 text-primary fw-bold">L·ªãch S·ª≠ Giao D·ªãch</h4>

            <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="pills-booking-tab" data-bs-toggle="pill" data-bs-target="#pills-booking" type="button">üìÖ L·ªãch ƒê·∫∑t H·∫πn</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-order-tab" data-bs-toggle="pill" data-bs-target="#pills-order" type="button">üíä ƒê∆°n Thu·ªëc Online</button>
                </li>
            </ul>

            <div class="tab-content" id="pills-tabContent">
                
                <div class="tab-pane fade show active" id="pills-booking">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>M√£</th>
                                    <th>Th√∫ c∆∞ng</th>
                                    <th>D·ªãch v·ª•</th>
                                    <th>Ng√†y h·∫πn</th>
                                    <th>Thanh to√°n</th> 
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="b : ${bookings}">
                                    <td class="fw-bold text-secondary" th:text="'#' + ${b.bookingId}"></td>
                                    <td th:text="${b.pet != null ? b.pet.name : '-'}"></td>
                                    <td th:text="${b.service != null ? b.service.name : '-'}"></td>
                                    <td>
                                        <span th:text="${b.bookingDate}"></span><br>
                                        <small class="text-muted" th:text="${b.startTime != null ? #temporals.format(b.startTime, 'HH:mm') : ''}"></small>
                                    </td>
                                    
                                    <td>
                                        <div th:if="${b.paymentStatus == 'PAID'}">
                                            <span class="badge bg-success-subtle text-success border border-success">
                                                <i class="fa-solid fa-check me-1"></i>ƒê√£ thanh to√°n
                                            </span>
                                            <div class="small text-muted fst-italic mt-1" th:text="${b.paymentMethod != null ? '(' + b.paymentMethod + ')' : ''}"></div>
                                        </div>
                                        
                                        <div th:unless="${b.paymentStatus == 'PAID'}">
                                            <div th:if="${b.status == 'COMPLETED'}">
                                                <span class="text-muted small"><i class="fa-solid fa-store"></i> Tr·∫£ t·∫°i qu·∫ßy</span>
                                                <div class="fw-bold text-secondary text-center" style="font-size: 0.7rem;">- HO·∫∂C -</div>
                                                <a th:href="@{/payment/create(type='BOOKING', id=${b.bookingId})}" class="btn btn-momo btn-sm w-100">
                                                    <i class="fa-solid fa-wallet me-1"></i> MoMo
                                                </a>
                                            </div>
                                            <div th:unless="${b.status == 'COMPLETED' or b.status == 'CANCELLED'}" class="text-muted small fst-italic">
                                                Thanh to√°n sau khi kh√°m
                                            </div>
                                            <span th:if="${b.status == 'CANCELLED'}" class="text-muted small">-</span>
                                        </div>
                                    </td>

                                    <td>
                                        <span th:class="${'badge ' + 
                                            (b.status == 'CONFIRMED' ? 'bg-primary' : 
                                            (b.status == 'COMPLETED' ? 'bg-success' : 
                                            (b.status == 'CANCELLED' ? 'bg-secondary' : 'bg-warning text-dark')))}" 
                                              th:text="${b.status}">
                                        </span>
                                    </td>
                                    <td>
                                        <form th:if="${b.status == 'PENDING' or b.status == 'CONFIRMED'}" 
                                              th:action="@{/my-account/booking/cancel}" method="post" 
                                              onsubmit="return confirm('H·ªßy l·ªãch h·∫πn n√†y?');">
                                            <input type="hidden" name="bookingId" th:value="${b.bookingId}">
                                            <button class="btn btn-sm btn-outline-danger"><i class="fa-solid fa-xmark"></i> H·ªßy</button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane fade" id="pills-order">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>M√£ ƒê∆°n</th> <th>Ng√†y ƒë·∫∑t</th> <th>ƒê·ªãa ch·ªâ</th> <th>S·∫£n ph·∫©m</th> <th>T·ªïng ti·ªÅn</th> <th>Tr·∫°ng th√°i</th> <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="o : ${orders}">
                                    <td class="fw-bold text-primary" th:text="'ORD-' + ${o.orderId}"></td>
                                    <td th:text="${#temporals.format(o.orderDate, 'dd-MM HH:mm')}"></td>
                                    <td class="small text-muted" th:text="${o.shippingAddress}"></td>
                                    <td>
                                        <div th:each="item : ${o.orderItems}" class="small">
                                            ‚Ä¢ <span th:text="${item.product.name}"></span> 
                                            <span class="fw-bold text-dark">x<span th:text="${item.quantity}"></span></span>
                                        </div>
                                    </td>
                                    <td class="fw-bold text-success" th:text="${#numbers.formatDecimal(o.totalAmount, 0, 'COMMA', 0, 'POINT')} + 'ƒë'"></td>
                                    <td>
                                        <span th:if="${o.status == 'PENDING'}" class="badge bg-warning text-dark">Ch·ªù x√°c nh·∫≠n</span>
                                        <span th:if="${o.status == 'CONFIRMED'}" class="badge bg-primary">ƒê√£ x√°c nh·∫≠n</span>
                                        <span th:if="${o.status == 'COMPLETED'}" class="badge bg-success">Ho√†n th√†nh</span>
                                    </td>
                                    <td>
                                        <div th:if="${o.status == 'PENDING'}">
                                            <a th:href="@{/payment/create(type='ORDER', id=${o.orderId})}" class="btn btn-momo btn-sm w-100"><i class="fa-solid fa-wallet"></i> MoMo</a>
                                        </div>
                                        <span th:if="${o.status == 'CONFIRMED'}" class="badge bg-success-subtle text-success border border-success"><i class="fa-solid fa-check"></i> ƒê√£ ch·ªët</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>